# Titan-Governance Agent Configuration v2.0
# All model IDs must match MODEL_REGISTRY in apps/web/src/lib/model-registry.ts

agents:
  supervisor:
    model: qwen3.5-plus-2026-02-15
    fallback: claude-sonnet-4.6
    role: Supreme Architect & Task Decomposer
    reads: [memory.md, plan.md, checklist.md]
    writes: [memory.md, plan.md]
    delegates_to: [coder, executor, verifier]
    max_reasoning: true

  executor:
    model: deepseek-reasoner
    fallback: gemini-2.0-flash
    role: Principal Engineer & Tool Specialist
    reads: [plan.md]
    writes: [execution.log]
    tools: [git, terminal, filesystem, database, api]
    error_protocol: report_only
    idempotency_check: required

  coder:
    model: qwen3-coder-next
    fallback: qwen3.5-plus-2026-02-15
    role: Technical Implementation Worker
    reads: []  # Receives only what Supervisor sends
    writes: []  # Output goes to Verifier, not to disk
    output_format: [inspection_evidence, code_artifact, self_review, verification_hints]
    forbidden: [placeholders, todos, stubs, happy_path_only]

  verifier:
    model: deepseek-reasoner
    fallback: qwen3.5-plus-2026-02-15
    role: Adversarial Quality Assassin
    reads: [checklist.md, plan.md]
    writes: [quality.log]
    orientation: adversarial
    default_assumption: broken
    forbidden: [suggest_fixes, approve_with_caveats]

protocol:
  fail_gate:
    on_fail: discard_artifact
    max_retries: 3
    on_max_retries: escalate_to_human
    patch_stacking: forbidden

  memory:
    memory_file: docs/memory.md
    plan_file: docs/plan.md
    checklist_file: docs/checklist.md
    memory_write: append_only
    memory_edit: forbidden
    memory_delete: forbidden

  verification:
    trigger: after_every_subtask
    skippable: false
    pass_with_findings: treated_as_fail

  context_isolation:
    coder_sees: [subtask, file_paths, code_snippets, success_criteria]
    coder_never_sees: [full_plan, memory, other_workers_output]
    executor_sees: [commands, expected_outputs, rollback_instructions]
    verifier_sees: [artifact, success_criteria, verification_criteria]

logging:
  execution_log: logs/execution.log
  quality_log: logs/quality.log
  violation_log: logs/violation.log

cost_optimization:
  cheap_models: [qwen3-coder-next, gemini-2.0-flash, deepseek-reasoner]
  expensive_models: [qwen3.5-plus-2026-02-15]
  compute_split: "80-90% cheap workers, 10-20% planning + verification"

# ═══ TITAN PROTOCOL v2: PARALLEL LANE CONFIGURATION ═══
# Extends the sequential protocol to parallel, DAG-scheduled execution.
# The original Titan Protocol (sequential) remains unchanged.
# This section configures the v2 parallel mode only.

protocol_v2:
  mode: parallel
  description: "Parallel multi-lane governance with DAG-scheduled execution"

  concurrency:
    max_concurrent_workers: 4
    max_concurrent_verifiers: 4
    max_lanes_per_manifest: 20
    lane_timeout_ms: 300000  # 5 minutes per lane

  agents:
    supervisor_model: qwen3.5-plus-2026-02-15
    default_worker_model: qwen3-coder-next
    default_verifier_model: deepseek-reasoner
    executor_model: gemini-2.0-flash
    worker_fallback: qwen3.5-plus-2026-02-15
    verifier_fallback: qwen3.5-plus-2026-02-15

  lane_lifecycle:
    statuses:
      - QUEUED
      - PROVISIONING
      - ASSIGNED
      - WORKING
      - PENDING_VERIFY
      - VERIFYING
      - VERIFIED
      - REJECTED
      - PENDING_REWORK
      - MERGE_CONFLICT
      - PENDING_RECONCILIATION
      - MERGED
      - FAILED
      - ARCHIVED
    terminal_statuses: [MERGED, FAILED, ARCHIVED]

  fail_gate:
    max_rework_attempts: 3
    on_max_rework: escalate_to_human
    on_fail: discard_artifact_completely
    patch_stacking: forbidden
    artifact_reuse: forbidden

  merge:
    strategy: sequential_verified
    conflict_resolution: supervisor_arbitrated
    integration_validation: build_and_lint
    merge_authority: supervisor_only

  safety_invariants:
    - "Exactly ONE Supervisor per manifest"
    - "Workers never communicate with each other"
    - "Verifiers never suggest fixes"
    - "No merge without: Coder output + Verifier PASS + Supervisor approval"
    - "Memory remains append-only (ADR format)"
    - "FAILED lanes must be rewritten, not patched"
    - "3 failures per lane → HALT + escalate"

# ═══ TITAN SUPREME PROTOCOL ═══
# 4-role governance with strict permission proxy and adaptive budgeting.
protocol_supreme:
  mode: supreme
  description: "Overseer/Operator/Primary Worker/Secondary Worker governance loop with zero-trust controls"

  agents:
    overseer_model: qwen3.5-plus-2026-02-15
    operator_model: deepseek-reasoner
    primary_worker_model: qwen3-coder-next
    secondary_worker_model: gemini-2.0-flash

  limits:
    max_overseer_iterations: 30
    max_worker_iterations: 12
    max_worker_tool_calls: 25
    max_operator_tool_calls: 20
    max_concurrent_workers: 4
    max_concurrent_verifiers: 2
    lane_timeout_ms: 300000
    max_rework_attempts: 2
    step_budget_warning: 70
    step_budget_hard_limit: 100

  token_budget:
    per_request: 500000
    daily: 10000000
    allocation:
      overseer_pct: 15
      workers_pct: 70
      operator_pct: 15

  governance:
    permission_proxy: overseer_only
    workers_tool_scope: read_only
    operator_scope: approved_steps_only
    threat_scan_required: true
    schema_validation_required: true
    adversarial_debate_threshold: 7
    consensus_quorum: 2
    consensus_followers: [primary_worker, secondary_worker, operator]
    worktree_isolation: true

# ═══ TITAN OMEGA PROTOCOL ═══
# Architect + Specialist Cadre + Sentinel + Operator with AST-aware, zero-trust execution.
protocol_omega:
  mode: omega
  description: "Omega governance — Architect + Specialist Cadre + Sentinel + Operator with AST-aware changes, predictive scaffolding, and zero-trust execution"

  agents:
    architect_model: qwen3.5-plus-2026-02-15
    sentinel_model: deepseek-reasoner
    operator_model: deepseek-reasoner
    specialist_low_risk: gemini-2.0-flash
    specialist_medium_risk: qwen3-coder-next
    specialist_high_risk: qwen3.5-plus-2026-02-15

  limits:
    max_concurrent_specialists: 4
    max_rework_attempts: 2
    max_dag_nodes: 12
    lane_timeout_ms: 300000
    step_budget_warning: 100
    step_budget_hard_limit: 150

  token_budget:
    per_request: 800000
    daily: 15000000

  features:
    enable_ast: true
    enable_dynamic_tests: true
    enable_integration_test: true
    enable_predictive_scaffolding: true

  governance:
    zero_trust: true
    plan_signing: sha256
    operator_scope: signed_plan_only
    specialist_scope: work_order_only
    sentinel_default_assumption: code_is_broken
